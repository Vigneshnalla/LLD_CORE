package main.java.com.vignesh.librarymanagement;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.UUID;

import main.java.com.vignesh.librarymanagement.enums.AccountStatus;
import main.java.com.vignesh.librarymanagement.model.book.Book;
import main.java.com.vignesh.librarymanagement.model.book.BookItem;
import main.java.com.vignesh.librarymanagement.model.people.Address;
import main.java.com.vignesh.librarymanagement.model.people.Librarian;
import main.java.com.vignesh.librarymanagement.model.people.LibraryCard;
import main.java.com.vignesh.librarymanagement.model.people.Member;

public class LibraryManagementSystem {
	private String id;
	private Address address;
	private static LibraryManagementSystem instance;
	
	private List<Book> books;
	private Map<String, Member> members;
	private Map<String, Librarian> librarians;
	
	
	  public Book findBookById(String bookId) {
	        return books.stream()
	                   .filter(book -> book.getId().equals(bookId))
	                   .findFirst()
	                   .orElse(null);
	    }
	  
	public boolean isValidMember(String memberId) {
	    Member member = members.get(memberId);

	    // Check if member exists
	    if (member == null) {
	        System.out.println("No member found with ID: " + memberId);
	        return false;
	    }

	    // Check if account is active
	    if (member.getAccountStatus() != AccountStatus.ACTIVE) {
	        System.out.println("Member account not active: " + memberId);
	        return false;
	    }

	    // Check library card validity
	    LibraryCard card = member.getLibraryCard();
	    if (card == null) {
	        System.out.println("No library card associated with member: " + memberId);
	        return false;
	    }

	    if (!card.isActive()) {
	        System.out.println("Library card is inactive for member: " + memberId);
	        return false;
	    }

	    if (card.isExpired()) {
	        System.out.println("Library card expired for member: " + memberId);
	        return false;
	    }

	    return true;
	}

	public boolean blockMember(String memberId) {
		if(!isMemberExists(memberId)) return false;
		Member member = members.get(memberId);
		member.setAccountStatus(AccountStatus.BLOCKED);
		return true;
		
	}
	public boolean unblockMemberId(String memberId){
		if(!isMemberExists(memberId)) return false;
		Member member = members.get(memberId);
		member.setAccountStatus(AccountStatus.ACTIVE);
		return true;
		
	}
	
	public void addBook(BookItem bookItem) {
		books.add(bookItem);
	}
	

	
	public void removeBook(BookItem bookItem) {
		books.remove(bookItem);
	}
	public List<Book> getBooks(){
		return books;
	}
	
	private LibraryManagementSystem() {
		books = new ArrayList<>();
		members = new HashMap<>();
		librarians = new HashMap<>();
		id = UUID.randomUUID().toString();
	}
	
	public static LibraryManagementSystem getInstance() {
		if(instance == null) 
			instance = new LibraryManagementSystem();
			
		return instance;
		
	}
	
	
	public boolean isMemberExists(String memberId) {
		Member member = members.get(memberId);

	    // Check if member exists
	    if (member == null) {
	        System.out.println("No member found with ID: " + memberId);
	        return false;
	    }
	    return true;
	}
	
}
